resources:
  pipelines:
    turbofan_dlt_pipeline:
      name: "Turbofan Predictive Maintenance - ${bundle.target}"
      target: "${var.schema_name}"

      # Serverless based on environment
      serverless: true

      configuration:
        catalog_name: "${var.catalog_name}"
        schema_name: "${var.schema_name}"
        project_name: "${var.project_name}"
        landing_zone_path: "${var.landing_zone_path}"
        checkpoint_path: "${var.checkpoint_path}"

      libraries:
        - file:
            path: ${var.project_workspace_path}/src/dlt/turbofan_pipeline.py

      # These will be overridden by environment variables
      development: true
      continuous: false

      channel: CURRENT
      edition: ADVANCED
      catalog: ${var.catalog_name}

      clusters:
        - label: default
          autoscale:
            min_workers: 1
            max_workers: 4
          spark_conf:
            spark.databricks.delta.optimizeWrite.enabled: "true"
            spark.databricks.delta.autoCompact.enabled: "true"

      notifications:
        - email_recipients:
            - ${var.notification_email}
          alerts:
            - "on-update-failure"
            - "on-flow-failure"